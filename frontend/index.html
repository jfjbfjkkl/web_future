<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="nexy-loader">
      <div class="grid-bg"></div>

      <div class="loader-center">
        <div class="logo-glitch">NEXY SHOP</div>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
        <div class="loading-text">Initialisation du monde gaming...</div>
      </div>
    </div>

    <script>
      (function () {
        const KEY = "nexy_loader_seen";
        const loader = document.getElementById("nexy-loader");
        if (!loader) return;

        let hasSeen = false;
        try {
          hasSeen = sessionStorage.getItem(KEY) === "1";
        } catch (e) {
          // sessionStorage blocked, fall back to always showing.
        }

        if (hasSeen) {
          loader.remove();
          return;
        }

        const markSeen = () => {
          try {
            sessionStorage.setItem(KEY, "1");
          } catch (e) {
            // ignore storage errors
          }
        };

        const isMobile = window.matchMedia && window.matchMedia("(max-width: 600px), (hover: none)").matches;
        const totalMs = isMobile ? 1800 : 2400; // 2â€“3s max
        const exitMs = 400;

        window.addEventListener("load", () => {
          // Optional startup sound (only on first session run)
          try {
            const audio = new Audio("/startup.mp3");
            audio.volume = 0.4;
            audio.play().catch(() => {});
          } catch (e) {}

          window.setTimeout(() => {
            loader.style.transition = `transform ${exitMs}ms ease, opacity ${exitMs}ms ease`;
            loader.style.transform = "translateY(-100%)";
            loader.style.opacity = "0";

            window.setTimeout(() => {
              loader.remove();
              markSeen();
            }, exitMs + 50);
          }, Math.max(0, totalMs - exitMs));
        });
      })();
    </script>

    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
